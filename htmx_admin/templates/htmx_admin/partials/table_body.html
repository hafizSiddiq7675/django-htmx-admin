{% load i18n admin_urls htmx_admin_tags %}
{% if cl.result_list %}
<table id="result_list">
    <thead>
        <tr>
            <th scope="col" class="action-checkbox-column">
                <div class="text">
                    <span><input type="checkbox" id="action-toggle"></span>
                </div>
            </th>
            {% for i, field_name in cl.list_display|enumerate %}
            {% if field_name != 'action_checkbox' %}
            <th scope="col" class="column-{{ field_name }}">
                <div class="text">
                    <a href="?o={{ i|sort_param:cl }}"
                       hx-get="{% htmx_table_body_url opts %}?o={{ i|sort_param:cl }}"
                       hx-target="#result-list-container"
                       hx-swap="innerHTML"
                       class="sortable">
                        {{ field_name|capfirst }}
                        {% with current_order=i|current_sort_order:cl %}
                        {% if current_order %}
                        <span class="sort-indicator">{% if current_order == 'desc' %}▼{% else %}▲{% endif %}</span>
                        {% endif %}
                        {% endwith %}
                    </a>
                </div>
            </th>
            {% endif %}
            {% endfor %}
            {% if list_editable_htmx %}
            <th scope="col">
                <div class="text">
                    <span>{% translate "Actions" %}</span>
                </div>
            </th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for result in cl.result_list %}
        <tr class="{% cycle 'row1' 'row2' %}" data-row-id="{{ result.pk }}">
            <td class="action-checkbox">
                <input type="checkbox" name="_selected_action" value="{{ result.pk }}" class="action-select">
            </td>
            {% for field_name in cl.list_display %}
            {% if field_name != 'action_checkbox' %}
            <td class="field-{{ field_name }}">
                {% if field_name in list_editable_htmx %}
                {% include "htmx_admin/partials/table_cell.html" with object=result field=field_name value=result|get_field_value:field_name is_editable=True %}
                {% else %}
                {{ result|get_field_value:field_name }}
                {% endif %}
            </td>
            {% endif %}
            {% endfor %}
            {% if list_editable_htmx %}
            <td class="htmx-actions">
                <button type="button"
                        class="btn-edit"
                        hx-get="{% htmx_modal_url opts result.pk %}"
                        hx-target="#modal-container"
                        hx-swap="innerHTML"
                        title="{% translate 'Edit' %}">
                    &#9998;
                </button>
                <button type="button"
                        class="btn-delete"
                        hx-delete="{% htmx_delete_url result %}"
                        hx-confirm="{% translate 'Are you sure you want to delete this item?' %}"
                        hx-target="closest tr"
                        hx-swap="outerHTML swap:300ms"
                        title="{% translate 'Delete' %}">
                    &#128465;
                </button>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
<p class="paginator">{{ cl.result_count }} {{ opts.verbose_name_plural }}</p>
{% else %}
<p class="paginator">{% translate "0 results" %}</p>
{% endif %}
